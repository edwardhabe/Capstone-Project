---
title: Exploratory Phase
output: html_notebook
---

First, I'll begin by setting up any packages I need and clearing R's brain.

```{r}
rm(list = ls())
library(here)
library(tidyverse)
library(ggfortify)
```

Now, to import my data, ensuring that I turn on "stringsAsFactors=TRUE"

```{r}
Bacteria_Data <- read.csv(here("Data", "AS-Raw-Data-Indicator-bacteria-project.csv"), stringsAsFactors=TRUE)
```

The first variable I'll work with is pH. Using a histogram, I can search for outliers and get a better idea of how my data looks. 

```{r}
ggplot(Bacteria_Data, aes(x=pH)) +
  geom_histogram()

## This data looks pretty consistent within a certain range. However, there may be a couple of  outliers on the lower end of the scale. 
```

Now, I'll look at Temperature using another histogram. 

```{r}
ggplot(Bacteria_Data, aes(x=Temperature)) +
  geom_histogram()

## Again, this data looks pretty consistent. On the higher end of the range, there could be some outliers to look out for. 
```

For my last variable, I'll look at total coliform count. 


```{r}
ggplot(Bacteria_Data, aes(x=Coliform_MPN)) + 
  geom_histogram()

##Things are pretty consistent here besides a major outlier I can identify. That one's at around 80,000 MPN and could carry some high leverage. 
```
Next, to get an overall summary of my data for assessment of all variables and their statistics. 

```{r}
summary(Bacteria_Data)

## The summary() function shows important information about data such as min, max, and quartiles. This is useful in assessing the quality of data, and also determining if there are any NA's in a larger data set. I'm noticing that there are some NA values, and that max values are very different from means in some variables, such as coliform count (nearly 60,000 MPN difference). Things like this should be taken into account when searching for potential outliers. 
```
I'll make a scatterplot of temperature vs. Coliform count from all samples. This will allow me to make assumptions about their relationship outside of my prior research. 

```{r}
ggplot(Bacteria_Data, aes(x=Temperature, y=Coliform_MPN)) +
  geom_point() +
  theme_bw()

## Temperature will show up on my x-axis, and coliform count will be my y-axis. I find this the most appropriate for visualization of data, as we see coliform data increase or decrease along temperature increase. 
```

My first thoughts upon seeing this data refute my initial hypothesis. There appears to be no linear trend popping out to me. It looks more like a wall of points more than anything. Later tests will better demonstrate this relationship, though. 

For these next couple of steps, I'll go above data exploration into attempting some tests. I had already written out this code, so I'll stick with it rather than deleting it. I've done this for all variables in my data set that I'm analyzing.


Now, I'll create a new data set which solely relates temperature to coliform count. This will follow the linear regression model of data analysis. 

```{r}
Temperature_mod <- lm(Temperature ~ Coliform_MPN, data=Bacteria_Data)

## This sets us up to use autoplot(). 
```

autoplot() will demonstrate different distributions of the data. When using linear regression, we're assuming that we have evenly distributed data and equal distances between points and a line. 

```{r}
autoplot(Temperature_mod)
```

Fitted values appear quite flat, and theoretical quantities seem linear. From using autoplot, I can determine that my data should be good to carry on with statistical testing. 

The anova test will determine whether or not the relationship between my two variables is significant or not. A p-value less than 0.05 indicates a significant relationship. 


```{r}
anova(Temperature_mod)

## This data set includes outliers which I've identified. I believe that this will impact p-value, so I'll remove them in a later step to see if it changes. 
```

A p-value of 0.6593 is far from significant, meaning that from this data in its current state, temperature is not a good indication of total coliform count. 

Now, to repeat this process with pH instead. I'll attempt to demonstrate the relationship between pH and total coliform count within samples. First to make a scatterplot of pH vs. coliform count. 


```{r}
ggplot(Bacteria_Data, aes(x=pH, y=Coliform_MPN)) +
  geom_point()+
  theme_bw()
```
Like in the case of temperature, this scatterplot does not appear to be positive for a relationship between the two variables. The points don't visually correspond to a trend, and are quite randomly spread about. Again, I don't predict a significant correlation. 

Now to create a new model for analyzing solely pH and coliform count. 

```{r}
pH_mod <- lm(pH ~ Coliform_MPN, data=Bacteria_Data)
```

Time to autoplot this new dataset. 


```{r}
autoplot(pH_mod)
```

Judging from the relatively flat fitted values and linear points within 'theoretical quantiles', this data should be good to use statistical tests on. 


Again, I'll use anova to test the relationship between my two variables, this time pH and coliform count. 

```{r}
anova(pH_mod)
```

This test demonstrates that the relationship between pH and coliform count is not significant, with a p-value of .5298. However, the relationship between pH and coliform count is more significant than that of temperature and coliform count. 

As relationships between coliform count and pH/temperature are not significant, I decided to test the relationship of these two variables with E. coli specifically. E. coli is a type of coliform, however, this new data will be specified for it only. Some of my research surrounding temperature and pH related to E. coli, so I'm hoping that these relationships appear more significant. 

First, to make a histogram of E. coli counts. 

```{r}
ggplot(Bacteria_Data, aes(x=Ecoli_MPN))+
  geom_histogram()
```
I notice a huge gap between the highest value and the secnd highest value. The max of this data is nearly 50,000 while the next highest is about 20,000. This is a huge gap and will likely throw off data, since the max point will have great leverage. 

Now, I'll make a scatterplot depicting the relationship between E. coli count and temperature. 

```{r}
ggplot(Bacteria_Data, aes(x=Temperature, y=Ecoli_MPN)) +
         geom_point()+
         theme_bw()
```
This is extremely hard to visualize due to the outlier. Since its value is far greater than other points, the chart is skewed and everything is clustered at the bottom. Points may be increasing linearly, but it's difficult to tell at first glance. 

Next step is to set things up for autoplot. 

```{r}
Temp_Ecoli_mod <- lm(Temperature ~ Ecoli_MPN, data = Bacteria_Data)
```

```{r}
autoplot(Temp_Ecoli_mod)
```

Fitted values are generally flat, except towards their ends. Theoretical values do appear to follow a linear trend, so I'd say that this data is okay to run more tests on. 


```{r}
anova(Temp_Ecoli_mod)
```

The relationship between E. coli count and temperature is not significant at a p-value of 0.2883. However, it is far more significant than the relationship between total coliform count and temperature (p=0.6593). This may suggest that temperature could be a more significant predictor of E. coli growth specifically. 

Now to repeat this all with pH. 


```{r}
ggplot(Bacteria_Data, aes(x=pH, y=Ecoli_MPN)) +
  geom_point()+
  theme_bw()
```
I'm facing the same issue with this scatterplot. The outlier skews how everything is formatted, so points are heavily condensed on the y-axis. I believe that I see somewhat of a linear trend, though. However, it's difficult to tell immediately how positive of a linear relationship there is. 

Setting up for autoplot.  

```{r}
pH_Ecoli_mod <- lm(pH ~ Ecoli_MPN, data=Bacteria_Data)
```

```{r}
autoplot(pH_Ecoli_mod)
```

Fitted values are a bit less flat, but still relatively flat overall. I think that the outlier may be causing this to occur. Theoretical quantiles do appear to follow a linear trend, so I'll run the appropriate statistical test on this. 

Time to run anova on pH vs. E. coli count. 

```{r}
anova(pH_Ecoli_mod)
```

This shows that the relationship between pH and E. coli count is not significant--even less significant than temperature and E. coli count. This is a lesser p-value than that of pH vs. total coliform count (p=0.5298), but not by much. Interestingly, pH was  a greater indicator of total coliform count than temperature. This flipped in the case of solely E. coli count. 

For the next part of my data exploration/analysis, I'll be removing major identified outliers in my data. I'll then perform the exact same statistical tests (and charts) as above to see any differences in p-values. I had already written this code prior to realizing I didn't need to, so I'll leave my filtering and tests. 

Let's begin with coliform count. I'll be removing anything greater than 80,000 MPN, as this appears to be where the greatest outlier stands. 

```{r}
Coliform_wo_Outliers <- filter(Bacteria_Data, Coliform_MPN < 80000)

## I'm using filter() to select all data greater than 80,000, first specifying my initial data set. Then, I select the column I wish to filter from, reassigning this value to another new data set. 
```

Now, to plot my new coliform data against temprature. 

```{r}
ggplot(Coliform_wo_Outliers, aes(x=Temperature, y=Coliform_MPN)) +
  geom_point()+
  theme_bw()
```
This scatterplot looks quite similar, considering we've likely only removed one point. I'm curious as to how much this one point impacted the relationship between these variables overall, though. 

Now to set things up for autoplot. 

```{r}
Temp_coli_wo_outliers_mod <- lm(Temperature ~ Coliform_MPN, data=Coliform_wo_Outliers)
```


```{r}
autoplot(Temp_coli_wo_outliers_mod)
```
These fitted values appear flat, and points under theoretical quantiles are still linear. Time to use anova! 

```{r}
anova(Temp_coli_wo_outliers_mod)
```

With the outlier point removed, the relationship between temperature and total coliform count is more evident with a decreased p-value of 0.4242 (down from p=0.6593). This demonstrates how much leverage just one outlier had on the rest of my data. 

Now, to look for the relationship between pH and my new coliform data (without outliers). Let's set things up for autoplot. 


```{r}
pH_coli_wo_outliers <- lm(pH ~ Coliform_MPN, data=Coliform_wo_Outliers)
```

```{r}
autoplot(pH_coli_wo_outliers)
```
Fitted values look flat and theoretical quantile points appear linear. Now to use anova! 


```{r}
anova(pH_coli_wo_outliers)
```

Interestingly, the P value with this new dataset has increased for pH and coliform count. Initially it was 0.5298, but without our main outlier, it is 0.6221. Perhaps this point followed a more outlying relationship with pH, but didn't in the case of temperature. Either way, it had great leverage over the entire dataset to change p-values this much. 

Now, to remove outliers from the E. coli column specifically. I've decided to try removing anything 40,000 MPN or greater, as this appears to be the primary outlier when viewing my histogram. 

```{r}
Ecoli_wo_outliers <- filter(Bacteria_Data, Ecoli_MPN <40000)
```

Setting things up for autoplot of temperature vs. E. coli count w/o outliers. 

```{r}
temp_Ecoli_wo_outliers <- lm(Temperature ~ Ecoli_MPN, data=Ecoli_wo_outliers)
```

```{r}
autoplot(temp_Ecoli_wo_outliers)
```

Fitted values seem relatively flat, and theoretical quartiles follow a linear trend. Looks good to run statistical tests on! 


```{r}
anova(temp_Ecoli_wo_outliers)
```

A p-value of .4564 is far less significant than the 0.2883 which came from data containing the outlier. A large change in p-value is expected when a point has high leverage. 

Now, to test the relationship between E. coli count and pH of a sample. 

```{r}
pH_Ecoli_wo_outliers <- lm(pH ~ Ecoli_MPN, data=Ecoli_wo_outliers)
```

```{r}
autoplot(pH_Ecoli_wo_outliers)
```
```{r}
anova(pH_Ecoli_wo_outliers)
```

This is the closest we've gotten so far to a significant p-value! Initially 0.517, the new p-value without our outlier point is 0.1555. This implies that pH is likely a greater indicator of E. coli growth than temperature, with or without the outlier. 

In further analysis, I may try removing outliers in coliform or E. coli count themselves. I will also remove NA values from columns when I work with this data again. 

